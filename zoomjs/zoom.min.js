+function(e){"use strict";function n(){this._activeZoom=this._initialScrollPosition=this._initialTouchPosition=this._touchMoveListener=null,this._$document=e(document),this._$window=e(window),this._$body=e(document.body),this._boundClick=e.proxy(this._clickHandler,this)}n.prototype.listen=function(){this._$body.on("click",'[data-action="zoom"]',e.proxy(this._zoom,this))},n.prototype._zoom=function(n){var s=n.target;if(!s||s.tagName!="IMG")return;if(this._$body.hasClass("zoom-overlay-open"))return;if(n.metaKey||n.ctrlKey)return window.open(n.target.getAttribute("data-original")||n.target.src,"_blank");if(s.width>=e(window).width()-t.OFFSET)return;this._activeZoomClose(!0),this._activeZoom=new t(s),this._activeZoom.zoomImage(),this._$window.on("scroll.zoom",e.proxy(this._scrollHandler,this)),this._$document.on("keyup.zoom",e.proxy(this._keyHandler,this)),this._$document.on("touchstart.zoom",e.proxy(this._touchStart,this)),document.addEventListener?document.addEventListener("click",this._boundClick,!0):document.attachEvent("onclick",this._boundClick,!0),"bubbles"in n?n.bubbles&&n.stopPropagation():n.cancelBubble=!0},n.prototype._activeZoomClose=function(e){if(!this._activeZoom)return;e?this._activeZoom.dispose():this._activeZoom.close(),this._$window.off(".zoom"),this._$document.off(".zoom"),document.removeEventListener("click",this._boundClick,!0),this._activeZoom=null},n.prototype._scrollHandler=function(){this._initialScrollPosition===null&&(this._initialScrollPosition=e(window).scrollTop());var n=this._initialScrollPosition-e(window).scrollTop();Math.abs(n)>=40&&this._activeZoomClose()},n.prototype._keyHandler=function(e){e.keyCode==27&&this._activeZoomClose()},n.prototype._clickHandler=function(e){e.preventDefault?e.preventDefault():event.returnValue=!1,"bubbles"in e?e.bubbles&&e.stopPropagation():e.cancelBubble=!0,this._activeZoomClose()},n.prototype._touchStart=function(t){this._initialTouchPosition=t.touches[0].pageY,e(t.target).on("touchmove.zoom",e.proxy(this._touchMove,this))},n.prototype._touchMove=function(t){Math.abs(t.touches[0].pageY-this._initialTouchPosition)>10&&(this._activeZoomClose(),e(t.target).off("touchmove.zoom"))};function t(t){this._fullHeight=this._fullWidth=this._overlay=this._targetImageWrap=null,this._targetImage=t,this._$body=e(document.body)}t.OFFSET=80,t._MAX_WIDTH=2560,t._MAX_HEIGHT=4096,t.prototype.zoomImage=function(){var t=document.createElement("img");t.onload=e.proxy(function(){this._fullHeight=Number(t.height),this._fullWidth=Number(t.width),this._zoomOriginal()},this),t.src=this._targetImage.src},t.prototype._zoomOriginal=function(){this._targetImageWrap=document.createElement("div"),this._targetImageWrap.className="zoom-img-wrap",this._targetImage.parentNode.insertBefore(this._targetImageWrap,this._targetImage),this._targetImageWrap.appendChild(this._targetImage),e(this._targetImage).addClass("zoom-img").attr("data-action","zoom-out"),this._overlay=document.createElement("div"),this._overlay.className="zoom-overlay",document.body.appendChild(this._overlay),this._calculateZoom(),this._triggerAnimation()},t.prototype._calculateZoom=function(){this._targetImage.offsetWidth;var n=this._fullWidth,s=this._fullHeight,l=e(window).scrollTop(),o=n/this._targetImage.width,i=e(window).height()-t.OFFSET,a=e(window).width()-t.OFFSET,r=n/s,c=a/i;n<a&&s<i?this._imgScaleFactor=o:r<c?this._imgScaleFactor=i/s*o:this._imgScaleFactor=a/n*o},t.prototype._triggerAnimation=function(){this._targetImage.offsetWidth;var t,n,s=e(this._targetImage).offset(),o=e(window).scrollTop(),i=o+e(window).height()/2,a=e(window).width()/2,r=s.top+this._targetImage.height/2,c=s.left+this._targetImage.width/2;this._translateY=i-r,this._translateX=a-c,n="scale("+this._imgScaleFactor+")",t="translate("+this._translateX+"px, "+this._translateY+"px)",e.support.transition&&(t+=" translateZ(0)"),e(this._targetImage).css({"-webkit-transform":n,"-ms-transform":n,transform:n}),e(this._targetImageWrap).css({"-webkit-transform":t,"-ms-transform":t,transform:t}),this._$body.addClass("zoom-overlay-open")},t.prototype.close=function(){if(this._$body.removeClass("zoom-overlay-open").addClass("zoom-overlay-transitioning"),e(this._targetImage).css({"-webkit-transform":"","-ms-transform":"",transform:""}),e(this._targetImageWrap).css({"-webkit-transform":"","-ms-transform":"",transform:""}),!e.support.transition)return this.dispose();e(this._targetImage).one(e.support.transition.end,e.proxy(this.dispose,this)).emulateTransitionEnd(300)},t.prototype.dispose=function(){this._targetImageWrap&&this._targetImageWrap.parentNode&&(e(this._targetImage).removeClass("zoom-img").attr("data-action","zoom"),this._targetImageWrap.parentNode.replaceChild(this._targetImage,this._targetImageWrap),this._overlay.parentNode.removeChild(this._overlay),this._$body.removeClass("zoom-overlay-transitioning"))},e(function(){(new n).listen()})}(jQuery)